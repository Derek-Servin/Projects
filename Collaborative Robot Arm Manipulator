#include <Servo.h>
// Code By Derek Servin
// TSC3200 code by Rui & Sara from https://randomnerdtutorials.com/arduino-color-sensor-tcs230-tcs3200/

//motor setup
int BasePin1 = 9; //base motor
int BasePin2 = 10; //arm motor
int BasePin3 = 11; //claw motor
Servo Servo1;
Servo Servo2;
Servo Servo3;


//TCS3200 setup
#define S0 4
#define S1 5
#define S2 6
#define S3 7
#define sensorOut 8

int R_frequency = 0;
int G_frequency = 0;
int B_frequency = 0;

int GR_frequency = 0;
int GG_frequency = 0;
int GB_frequency = 0;


#define NUM_READINGS 4
int colorReadings[NUM_READINGS];

void setup() {
  pinMode(S0, OUTPUT);
  pinMode(S1, OUTPUT);
  pinMode(S2, OUTPUT);
  pinMode(S3, OUTPUT);
  pinMode(sensorOut, INPUT);
 
  // Setting frequency-scaling to 20%
  digitalWrite(S0,HIGH);
  digitalWrite(S1,LOW);


  //pwm motor setup
  Servo1.attach(BasePin1);
  Servo2.attach(BasePin2);
  Servo3.attach(BasePin3);
 
  Serial.begin(9600);

  // Initial Positions
  
  Servo2.write(70); //IDLE MODE
  //delay(500);
  Servo1.write(88);//88
  
  Servo3.write(55);//open30,close70,grip72
  //delay(400);
  //Servo3.write(62);
  Serial.println(" IDLE MODE ");

  


}

void loop() {



  //-----------------------------------------------------------------------------------
  //Robot motion logic
  //-----------------------------------------------------------------------------------   
  
  // Reset color readings array
  memset(colorReadings, 0, sizeof(colorReadings));

  // Read color values multiple times
  for (int i = 0; i < NUM_READINGS; i++) {
    Serial.println(" TEST: ");
    digitalWrite(S2,LOW);
    digitalWrite(S3,LOW);
    // Reading the output frequency
    R_frequency = pulseIn(sensorOut, LOW);
    //Remaping the value of the frequency to the RGB Model of 0 to 255
    R_frequency = map(R_frequency, 25,72,255,0);
    // Printing the value on the serial monitor
    Serial.print("R= ");//printing name
    Serial.print(R_frequency);//printing RED color frequency
    Serial.print("  ");
    delay(100);

    // Setting Green filtered photodiodes to be read
    digitalWrite(S2,HIGH);
    digitalWrite(S3,HIGH);
    // Reading the output frequency
    G_frequency = pulseIn(sensorOut, LOW);
    //Remaping the value of the frequency to the RGB Model of 0 to 255
    G_frequency = map(G_frequency, 30,90,255,0);
    // Printing the value on the serial monitor
    Serial.print("G= ");//printing name
    Serial.print(G_frequency);//printing GREEN color frequency
    Serial.print("  ");
    delay(100);

    // Setting Blue filtered photodiodes to be read
    digitalWrite(S2,LOW);
    digitalWrite(S3,HIGH);
    // Reading the output frequency
    B_frequency = pulseIn(sensorOut, LOW);
    //Remaping the value of the frequency to the RGB Model of 0 to 255
    B_frequency = map(B_frequency, 25,70,255,0);
    // Printing the value on the serial monitor
    Serial.print("B= ");//printing name
    Serial.print(B_frequency);//printing BLUE color frequency
    Serial.println("  ");
    delay(100);
  

    Serial.println(i);

    

    // Determine the color and store it in the readings array
    if (R_frequency >= 200 && G_frequency <= 110 && B_frequency <= 130 ||
        R_frequency >= 100 && G_frequency <= 0 && B_frequency <= 0) {
      colorReadings[i] = 1; // RED
      Serial.println(" RED ");
      Serial.println(i+1);
    } else if (R_frequency <= 100 && G_frequency >= 150 && B_frequency <= 180 || R_frequency <= 178 && G_frequency >= 200 && B_frequency <= 201) {
       colorReadings[i] = 6; // GREEN
       Serial.println(" GREEN ");
       Serial.println(i+1);
    } else if (R_frequency >= 220 && G_frequency >= 90 && G_frequency <= 150 && B_frequency <= 80) {
      colorReadings[i] = 3; // ORANGE
      Serial.println(" ORANGE ");
      Serial.println(i+1);
    } else if (R_frequency >= 215 && G_frequency >= 170 && B_frequency <= 160 || R_frequency >= 230 && G_frequency >= 230 && B_frequency <= 185 || R_frequency >= 250 && G_frequency >= 250 && B_frequency <= 220) {
      colorReadings[i] = 4; // YELLOW
      Serial.println(" YELLOW ");
      Serial.println(i+1);
    } else if (R_frequency >= 200 && G_frequency <= 235 && B_frequency >= 180 ||
        R_frequency >= 90 && R_frequency <= 210 && G_frequency <= 80 && B_frequency >= 90) {
      colorReadings[i] = 5; // PURPLE
      Serial.println(" PURPLE ");
      Serial.println(i+1);
    
    } else if (B_frequency >= 170 && R_frequency <= 50 || R_frequency <=5 && R_frequency >=0 && B_frequency <=195 && B_frequency >=0 ||
             R_frequency <= 30 && G_frequency <= 25 && B_frequency >= 120) {
      colorReadings[i] = 2; // BLUE
      Serial.println(" BLUE ");
      Serial.println(i+1);
    }

    if(i>=2 && R_frequency <-150 && G_frequency <-150 && B_frequency <-150)
        {
          
          Serial.println(" NO READING ");
          break;

        }
     delay(300); 
   }

   

   // Determine the majority color
   int readColor = checkAllSameColor();
   printColor(readColor);
 }

  int checkAllSameColor() {
  int firstColor = colorReadings[0];

  for (int i = 1; i < NUM_READINGS; i++) {
    if (colorReadings[i] != firstColor) {
      return 0; // Not all readings are the same color
    }
  }

  return firstColor; // All readings are the same color
}



void printColor(int color) {
  if (color != 0) {
    switch (color) {
    case 1:
      if (Servo2.read()==70)
      {
        break;
      }
      else{
      Serial.println(" All Readings are RED");
      Serial.print("motor move RED ");
  
      Servo3.write(63);//open30,close70,grip72
      delay(1000);
      Servo3.write(76);//close claw
      delay(800);   
      Servo2.write(85);//UP
      delay(800);
      Servo1.write(0);//RIGHT  28,88,148
      delay(800);
      Servo2.write(110);//DOWN
      delay(800);
      Servo3.write(65);//Open claw
      delay(800);
      Servo3.write(73);//ADJUST
      delay(400);
      Servo3.write(65);//BLOCK
      delay(400);
      Servo2.write(100);
        delay(400);
        Servo2.write(90);
        delay(400);
      Servo2.write(85);//UP
      delay(800);
      Servo1.write(88);//HOME
      delay(800);
      Servo2.write(112);//DOWN
      break;
      }
    case 2:
      if (Servo2.read()==70)
      {
        break;
      }
      else{
     Serial.println(" All Readings are BLUE");
      Servo3.write(63);//open30,close70,grip72
      delay(1000);
      Servo2.write(108);
      delay(700);
      Servo3.write(76);//close claw
      delay(800);    
      Servo2.write(85);//UP
      delay(800);
      Servo1.write(175);//FAR LEFT  28,88,148,160
      delay(800);
      Servo2.write(110);//DOWN
      delay(800);
      Servo3.write(70);//Open claw
      delay(800);
      Servo3.write(73);//adjust block with claw
      delay(200);
      Servo3.write(65);//adjust block with claw
      delay(800);
      Servo2.write(100);
      delay(400);
      Servo2.write(90);
      delay(400);
      Servo2.write(85);//UP
      delay(800);
      Servo1.write(88);//HOME
      delay(800);
      Servo2.write(112);//DOWN
      break;
      }
    case 3:
      Serial.println(" All Readings are ORANGE");

      break;

    case 4:
      if (Servo2.read()==70)
      {
        break;
      }
      else{
      Serial.println(" All Readings are YELLOW");
      Servo3.write(60);//open30,close70,grip72
      delay(1000);
      Servo3.write(75); 
      delay(800);      
      Servo2.write(85);//UP
      delay(800);
      Servo1.write(46);//MID RIGHT  28,88,148
      delay(800);
      Servo2.write(112);//DOWN
      delay(800);
      Servo3.write(60); 
      delay(800); 
      Servo3.write(73);//ADJUST
      delay(400);
      Servo3.write(63);//BLOCK
      delay(400);
      Servo2.write(85);//UP
      delay(800);
      Servo1.write(88);//HOME segway
      delay(500);

      // Swapping Blocks

      Servo1.write(175);//FAR LEFT  28,88,138,175
      delay(800);
      Servo3.write(59);
      delay(400);
      Servo2.write(110);//DOWN
      delay(800);
      Servo3.write(74);//CLOSE claw
      delay(800);
      Servo2.write(85);//UP
      delay(800);
      Servo1.write(130);//MID LEFT  28,88,138,175
      delay(800);
      Servo2.write(105);//DOWN
      delay(800);
      Servo3.write(63);
      delay(800);
      Servo3.write(73);//ADJUST
      delay(400);
      Servo3.write(60);//BLOCK
      delay(800);

      Servo2.write(85);//UP
      delay(800);
      Servo1.write(0);//RIGHT  28,88,148
      delay(800);
      Servo2.write(110);//DOWN
      delay(800);
      Servo3.write(74);//CLOSE claw
      delay(800);
      Servo2.write(85);//UP
      delay(800);
      Servo1.write(175);//FAR LEFT  0,28,88,148,160
      delay(800);
      Servo2.write(110);//DOWN
      delay(800);
      Servo3.write(65);//OPEN claw
      delay(800);
      Servo3.write(73);//ADJUST
      delay(400);
      Servo3.write(59);//BLOCK
      delay(400);
      Servo2.write(85);//UP
      delay(1100);

      Servo1.write(130);//MID LEFT  28,88,138,175
      delay(800);
      Servo2.write(112);//DOWN
      delay(800);
      Servo3.write(75);
      delay(800);
      Servo2.write(85);//UP
      delay(800);

      Servo1.write(0);//FAR RIGHT  28,88,148
      delay(800);
      Servo2.write(111);//DOWN
      delay(800);
      Servo3.write(65);//OPEN claw
      delay(800);
      Servo3.write(73);//ADJUST
      delay(400);
      Servo3.write(63);//BLOCK
      delay(400);
      Servo2.write(85);//UP
      delay(800);

      // Home
      Servo1.write(88);//88
      delay(800);
      Servo2.write(112);//95 //115 //112 higher for block clearance
      delay(800);
      Servo3.write(65);//open60,close70,grip72
      break;
      }

      
    case 5:
      if (Servo2.read()==70)
      {
        break;
      }
      else{
      Serial.println(" All Readings are PURPLE");
      Servo3.write(62);//open30,close70,grip72
      delay(1000);
      // Grab block      
      Servo3.write(74);
      delay(800);
      Servo2.write(65);//UP
      delay(800);
      // Wave 
      Servo1.write(160);
      Servo2.write(60);
      delay(900);
      Servo1.write(150);
      Servo2.write(75);
      delay(200);
      Servo1.write(140);
      Servo2.write(90);
      delay(300);
      Servo1.write(130);
      Servo2.write(75);
      delay(200);
      Servo1.write(120);
      Servo2.write(60);
      delay(300);
      Servo1.write(110);
      Servo2.write(75);
      delay(200);
      Servo1.write(100);
      Servo2.write(90);
      delay(300);
      Servo1.write(90);
      Servo2.write(75);
      delay(200);
      Servo1.write(80);
      Servo2.write(60);
      delay(300);
      Servo1.write(70);
      Servo2.write(75);
      delay(200);
      Servo1.write(60);
      Servo2.write(90);
      delay(300);
      Servo1.write(50);
      Servo2.write(75);
      delay(200);
      Servo1.write(40);
      Servo2.write(60);
      delay(300);
      Servo1.write(20);
      Servo2.write(70);
      delay(200);
      Servo1.write(0);
      Servo2.write(90);

      delay(500);
      Servo2.write(75);
      Servo1.write(88);
      delay(200);
      Servo2.write(40);
      delay(500);
      Servo1.write(160);
      Servo2.write(90);
      delay(500);
      Servo2.write(40);

      //------------------------------------------------------
      Servo2.write(90);
      delay(800);
      Servo1.write(130);//MID LEFT  28,88,138,175
      delay(800);
      Servo2.write(112);//DOWN
      delay(800);
      Servo3.write(65);//OPEN
      delay(800);
      Servo3.write(73);//ADJUST
      delay(400);
      Servo3.write(63);//BLOCK
      delay(400);
      Servo2.write(85);//UP
      delay(800);

      // Home
      Servo1.write(88);//88
      delay(800);
      Servo2.write(112);//95 //115 //112 higher for block clearance
      delay(800);
      Servo3.write(65);//open60,close70,grip72

      break;
      }

    case 6:
      Serial.println(" All Readings are GREEN ");

      if(Servo2.read()!=70)
      {

        Servo3.write(63);//open30,close70,grip72
        delay(1000);

          //CHECK FOR BLUE HOME
          Servo3.write(60);//open30,close70,grip72
          delay(800);
          Servo2.write(85);//UP
          delay(800);
          Servo1.write(130);
          delay(400);
          Servo1.write(175);//FAR LEFT  138,175
          delay(800);       
          Servo3.write(61);
          delay(400);
          Servo2.write(80);
          delay(400);
          Servo2.write(90);
          delay(400);
          Servo2.write(100);
          delay(400);
          Servo2.write(112);//DOWN
          Servo3.write(73);
          delay(400);
          Servo3.write(61);
          delay(1200); //PAUSE TO READ COLOR

          while(true) {

            //READ COLOR GRGB_FREQ
            digitalWrite(S2,LOW);
            digitalWrite(S3,LOW);
            // Reading the output frequency
            GR_frequency = pulseIn(sensorOut, LOW);
            //Remaping the value of the frequency to the RGB Model of 0 to 255
            GR_frequency = map(GR_frequency, 25,72,255,0);
            // Printing the value on the serial monitor
            Serial.println(" GREEN READING: ");
            Serial.print("G R= ");//printing name
            Serial.print(GR_frequency);//printing RED color frequency
            Serial.print("  ");
            delay(100);

            // Setting Green filtered photodiodes to be read
            digitalWrite(S2,HIGH);
            digitalWrite(S3,HIGH);
            // Reading the output frequency
            GG_frequency = pulseIn(sensorOut, LOW);
            //Remaping the value of the frequency to the RGB Model of 0 to 255
            GG_frequency = map(GG_frequency, 30,90,255,0);
            // Printing the value on the serial monitor
            Serial.print("G G= ");//printing name
            Serial.print(GG_frequency);//printing GREEN color frequency
            Serial.print("  ");
            delay(100);

            // Setting Blue filtered photodiodes to be read
            digitalWrite(S2,LOW);
            digitalWrite(S3,HIGH);
            // Reading the output frequency
            GB_frequency = pulseIn(sensorOut, LOW);
            //Remaping the value of the frequency to the RGB Model of 0 to 255
            GB_frequency = map(GB_frequency, 25,70,255,0);
            // Printing the value on the serial monitor
            Serial.print("G B= ");//printing name
            Serial.print(GB_frequency);//printing BLUE color frequency
            Serial.println("  ");
            delay(100);
          
            // DISTINGUISH COLOR
            if (GR_frequency >= 200 && GG_frequency <= 70 && GB_frequency <= 85 ||
                GR_frequency >= 100 && GG_frequency <= 0 && GB_frequency <= 100) {
            
              Serial.println(" G RED ");
              
              Servo2.write(110);//slowUP
              delay(400);
              Servo2.write(100);
              delay(400);
              Servo2.write(90);
              delay(400);
              Servo2.write(80);//UP
              delay(500);
              Servo1.write(180);//FAR LEFT  28,88,148
              delay(500);
              Servo1.write(145);//right  28,88,148
              delay(500);
              Servo1.write(180);//FAR LEFT  28,88,148
              delay(500);
              Servo1.write(145);//right  28,88,148
              delay(500);
              break;

            } else if (GR_frequency <= 100 && GG_frequency >= 150 && GB_frequency <= 180) {
              
              Serial.println(" G GREEN ");
              Servo2.write(110);//slowUP
              delay(400);
              Servo2.write(100);
              delay(400);
              Servo2.write(90);
              delay(400);
              Servo2.write(80);//UP
              delay(500);
              Servo1.write(165);//FAR LEFT  28,88,148
              delay(500);
              Servo1.write(145);//right  28,88,148
              delay(500);
              Servo1.write(165);//FAR LEFT  28,88,148
              delay(500);
              Servo1.write(145);//right  28,88,148
              delay(500);

              break;
              
            } else if (GR_frequency >= 220 && GG_frequency >= 90 && GG_frequency <= 160 && GB_frequency <= 80) {
              
              Serial.println(" G ORANGE ");
              Servo2.write(110);//slowUP
              delay(400);
              Servo2.write(100);
              delay(400);
              Servo2.write(90);
              delay(400);
              Servo2.write(80);//UP
              delay(500);
              Servo1.write(165);//FAR LEFT  28,88,148
              delay(500);
              Servo1.write(145);//right  28,88,148
              delay(500);
              Servo1.write(165);//FAR LEFT  28,88,148
              delay(500);
              Servo1.write(145);//right  28,88,148
              delay(500);

              break;
              
            } else if (GR_frequency >= 215 && GG_frequency >= 215 && GB_frequency <= 200) {
              //colorReadings[i] = 4; // YELLOW
              Serial.println(" G YELLOW ");
              Servo2.write(110);//slowUP
              delay(400);
              Servo2.write(100);
              delay(400);
              Servo2.write(90);
              delay(400);
              Servo2.write(80);//UP
              delay(500);
              Servo1.write(165);//FAR LEFT  28,88,148
              delay(500);
              Servo1.write(145);//right  28,88,148
              delay(500);
              Servo1.write(165);//FAR LEFT  28,88,148
              delay(500);
              Servo1.write(145);//right  28,88,148
              delay(500);

              break;
              
            } else if (GR_frequency >= 200 && GG_frequency <= 235 && GB_frequency >= 180 || GR_frequency >= 90 && GR_frequency <= 210 && GG_frequency <= 80 && GB_frequency >= 90 || GR_frequency <= 100 && GG_frequency <= 70 && GB_frequency >= 120) {

              //colorReadings[i] = 5; // PURPLE
              Serial.println(" G PURPLE ");
              Servo2.write(110);//slowUP
              delay(400);
              Servo2.write(100);
              delay(400);
              Servo2.write(90);
              delay(400);
              Servo2.write(80);//UP
              delay(500);
              Servo1.write(165);//FAR LEFT  28,88,148
              delay(500);
              Servo1.write(145);//right  28,88,148
              delay(500);
              Servo1.write(165);//FAR LEFT  28,88,148
              delay(500);
              Servo1.write(145);//right  28,88,148
              delay(500);

              break;
            
            } else if (GB_frequency >= 170 && GR_frequency <= 50 || GR_frequency <=5 && GB_frequency <=195 && GG_frequency <=200 ||
             GR_frequency <= 30 && GG_frequency <= 25 && GB_frequency >= 100) {
              //colorReadings[i] = 2; // BLUE
              Serial.println(" G BLUE ");
              Servo2.write(110);//slowUP
              delay(400);
              Servo2.write(100);
              delay(400);
              Servo2.write(90);
              delay(300);
              Servo2.write(80);//UP
              delay(200);
              Servo2.write(60);//UP
              delay(500);
              Servo2.write(80);//down
              delay(500);
              Servo2.write(60);//UP
              delay(500);
              Servo2.write(80);//down
              delay(500);

              break;

            }
          }
      
        //MOVE TO NEXT BLOCK SHOULD BE PURPLE HOME       
        
        Servo3.write(62);//open30,close70,grip72
        delay(800);
        Servo2.write(85);//UP
        delay(800);
        Servo1.write(150);
        delay(400);
        Servo1.write(130);//MID LEFT  28,88,138,175
        delay(800);
        Servo2.write(80);
        delay(400);
        Servo2.write(90);
        delay(400);
        Servo2.write(100);
        delay(400);
        Servo2.write(112);//DOWN
        delay(800);
        Servo3.write(73);
        delay(400);
        Servo3.write(61);
        delay(1600); //PAUSE TO READ COLOR

        while(true){

          digitalWrite(S2,LOW);
          digitalWrite(S3,LOW);
          // Reading the output frequency
          GR_frequency = pulseIn(sensorOut, LOW);
          //Remaping the value of the frequency to the RGB Model of 0 to 255
          GR_frequency = map(GR_frequency, 25,72,255,0);
          // Printing the value on the serial monitor
          Serial.println(" GREEN READING: ");
          Serial.print("G R= ");//printing name
          Serial.print(GR_frequency);//printing RED color frequency
          Serial.print("  ");
          delay(100);

          // Setting Green filtered photodiodes to be read
          digitalWrite(S2,HIGH);
          digitalWrite(S3,HIGH);
          // Reading the output frequency
          GG_frequency = pulseIn(sensorOut, LOW);
          //Remaping the value of the frequency to the RGB Model of 0 to 255
          GG_frequency = map(GG_frequency, 30,90,255,0);
          // Printing the value on the serial monitor
          Serial.print("G G= ");//printing name
          Serial.print(GG_frequency);//printing GREEN color frequency
          Serial.print("  ");
          delay(100);

          // Setting Blue filtered photodiodes to be read
          digitalWrite(S2,LOW);
          digitalWrite(S3,HIGH);
          // Reading the output frequency
          GB_frequency = pulseIn(sensorOut, LOW);
          //Remaping the value of the frequency to the RGB Model of 0 to 255
          GB_frequency = map(GB_frequency, 25,70,255,0);
          // Printing the value on the serial monitor
          Serial.print("G B= ");//printing name
          Serial.print(GB_frequency);//printing BLUE color frequency
          Serial.println("  ");
          delay(100);
        
          // Determine the color 
          if (GR_frequency >= 200 && GG_frequency <= 70 && GB_frequency <= 85 ||
              GR_frequency >= 100 && GG_frequency <= 0 && GB_frequency <= 100) {
          
            Serial.println(" G RED ");
            Servo2.write(110);//slowUP
              delay(400);
            Servo2.write(80);//UP
            delay(500);
            Servo1.write(128);//FAR LEFT  28,88,148
            delay(500);
            Servo1.write(108);//right  28,88,148
            delay(500);
            Servo1.write(128);//FAR LEFT  28,88,148
            delay(500);
            Servo1.write(108);//right  28,88,148
            delay(500);
            break;

          } else if (GR_frequency <= 100 && GG_frequency >= 170 && GB_frequency <= 145) {
            
            Serial.println(" G GREEN ");
            Servo2.write(110);//slowUP
            delay(400);

            Servo2.write(80);//UP
            delay(500);
            Servo1.write(128);//FAR LEFT  28,88,148
            delay(500);
            Servo1.write(108);//right  28,88,148
            delay(500);
            Servo1.write(128);//FAR LEFT  28,88,148
            delay(500);
            Servo1.write(108);//right  28,88,148
            delay(500);
            break;
            
          } else if (GR_frequency >= 220 && GG_frequency >= 90 && GG_frequency <= 160 && GB_frequency <= 80) {
            
            Serial.println(" G ORANGE ");
            Servo2.write(110);//slowUP
              delay(400);

            Servo2.write(80);//UP
            delay(500);
            Servo1.write(128);//FAR LEFT  28,88,148
            delay(500);
            Servo1.write(108);//right  28,88,148
            delay(500);
            Servo1.write(128);//FAR LEFT  28,88,148
            delay(500);
            Servo1.write(108);//right  28,88,148
            delay(500);
            break;

          } else if (GR_frequency >= 215 && GG_frequency >= 215 && GB_frequency <= 175) {
            //colorReadings[i] = 4; // YELLOW
            Serial.println(" G YELLOW ");
            Servo2.write(110);//slowUP
            delay(400);

            Servo2.write(80);//UP
            delay(500);
            Servo1.write(128);//FAR LEFT  28,88,148
            delay(500);
            Servo1.write(108);//right  28,88,148
            delay(500);
            Servo1.write(128);//FAR LEFT  28,88,148
            delay(500);
            Servo1.write(108);//right  28,88,148
            delay(500);
            break;
            
          } else if (GR_frequency >= 200 && GG_frequency <= 235 && GB_frequency >= 180 || GR_frequency >= 90 && GR_frequency <= 210 && GG_frequency <= 80 && GB_frequency >= 90 || GR_frequency <= 100 && GG_frequency <= 70 && GB_frequency >= 120){
            //colorReadings[i] = 5; // PURPLE
            Serial.println(" G PURPLE ");
            Servo2.write(110);//slowUP
            delay(400);
            Servo2.write(100);
            delay(400);
            Servo2.write(90);
            delay(300);
            Servo2.write(70);//UP
            delay(400);
            Servo2.write(80);//down
            delay(500);
            Servo2.write(60);//UP
            delay(500);
            Servo2.write(80);//down
            delay(500);
            break;
          
          } else if (GB_frequency >= 170 && GR_frequency <= 50 || GR_frequency <=5 && GR_frequency >=0 && GB_frequency <=195 && GB_frequency >=0 ||
             GR_frequency <= 30 && GG_frequency <= 25 && GB_frequency >= 120) {
            //colorReadings[i] = 2; // BLUE
            Serial.println(" G BLUE ");
           Servo2.write(110);//slowUP
              delay(400);
              Servo2.write(100);
              delay(400);
              Servo2.write(90);
              delay(400);
              Servo2.write(80);//UP
            delay(500);
            Servo1.write(128);//FAR LEFT  28,88,148
            delay(500);
            Servo1.write(108);//right  28,88,148
            delay(500);
            Servo1.write(128);//FAR LEFT  28,88,148
            delay(500);
            Servo1.write(108);//right  28,88,148
            delay(500);
            break;
            

          }

        }

        //MOVE TO NEXT BLOCK SHOULD BE YELLOW HOME

        Servo2.write(85);//UP
        delay(800);
        Servo1.write(90);
        delay(400);
        Servo1.write(46);//MID RIGHT  28,88,148
        delay(800);
        Servo3.write(61);
        delay(800);
        Servo2.write(80);
        delay(400);
        Servo2.write(90);
        delay(400);
        Servo2.write(100);
        delay(400);
        Servo2.write(112);//DOWN
        delay(1200); //PAUSE TO READ COLOR

        while(true){

          digitalWrite(S2,LOW);
          digitalWrite(S3,LOW);
          // Reading the output frequency
          GR_frequency = pulseIn(sensorOut, LOW);
          //Remaping the value of the frequency to the RGB Model of 0 to 255
          GR_frequency = map(GR_frequency, 25,72,255,0);
          // Printing the value on the serial monitor
          Serial.println(" GREEN READING: ");
          Serial.print("G R= ");//printing name
          Serial.print(GR_frequency);//printing RED color frequency
          Serial.print("  ");
          delay(100);

          // Setting Green filtered photodiodes to be read
          digitalWrite(S2,HIGH);
          digitalWrite(S3,HIGH);
          // Reading the output frequency
          GG_frequency = pulseIn(sensorOut, LOW);
          //Remaping the value of the frequency to the RGB Model of 0 to 255
          GG_frequency = map(GG_frequency, 30,90,255,0);
          // Printing the value on the serial monitor
          Serial.print("G G= ");//printing name
          Serial.print(GG_frequency);//printing GREEN color frequency
          Serial.print("  ");
          delay(100);

          // Setting Blue filtered photodiodes to be read
          digitalWrite(S2,LOW);
          digitalWrite(S3,HIGH);
          // Reading the output frequency
          GB_frequency = pulseIn(sensorOut, LOW);
          //Remaping the value of the frequency to the RGB Model of 0 to 255
          GB_frequency = map(GB_frequency, 25,70,255,0);
          // Printing the value on the serial monitor
          Serial.print("G B= ");//printing name
          Serial.print(GB_frequency);//printing BLUE color frequency
          Serial.println("  ");
          delay(100);
        
          // Determine the color and store it in the readings array
          if (GR_frequency >= 200 && GG_frequency <= 70 && GB_frequency <= 85 ||
              GR_frequency >= 100 && GG_frequency <= 0 && GB_frequency <= 100) {
          
            Serial.println(" G RED ");
            Servo2.write(110);//slowUP
              delay(400);
              Servo2.write(100);
              delay(400);
              Servo2.write(90);
              delay(400);
              Servo2.write(80);//UP
            delay(500);
            Servo1.write(30);//LEFT  28,88,148
            delay(500);
            Servo1.write(50);//right  28,88,148
            delay(500);
            Servo1.write(30);//LEFT  28,88,148
            delay(500);
            Servo1.write(50);//right  28,88,148
            delay(500);
            break;

          } else if (GR_frequency <= 100 && GG_frequency >= 170 && GB_frequency <= 145) {
            
            Serial.println(" G GREEN ");
            Servo2.write(110);//slowUP
              delay(400);
              Servo2.write(100);
              delay(400);
              Servo2.write(90);
              delay(400);
              Servo2.write(80);//UP
            delay(500);
            Servo1.write(30);//LEFT  28,88,148
            delay(500);
            Servo1.write(50);//right  28,88,148
            delay(500);
            Servo1.write(30);//LEFT  28,88,148
            delay(500);
            Servo1.write(50);//right  28,88,148
            delay(500);
            break;
            
          } else if (GR_frequency >= 220 && GG_frequency >= 90 && GG_frequency <= 160 && GB_frequency <= 80) {
            
            Serial.println(" G ORANGE ");
            Servo2.write(110);//slowUP
              delay(400);
              Servo2.write(100);
              delay(400);
              Servo2.write(90);
              delay(400);
              Servo2.write(80);//UP
            delay(500);
            Servo1.write(30);//LEFT  28,88,148
            delay(500);
            Servo1.write(50);//right  28,88,148
            delay(500);
            Servo1.write(30);//LEFT  28,88,148
            delay(500);
            Servo1.write(50);//right  28,88,148
            delay(500);
            break;
            
          } else if (GR_frequency >= 215 && GG_frequency >= 215 && GB_frequency <= 200) {
            //colorReadings[i] = 4; // YELLOW
            Serial.println(" G YELLOW ");
            Servo2.write(110);//slowUP
              delay(400);
              Servo2.write(100);
              delay(400);
              Servo2.write(90);
              delay(400);
              Servo2.write(80);//UP
              delay(400);
            Servo2.write(60);//UP
            delay(500);
            Servo2.write(80);//down
            delay(500);
            Servo2.write(60);//UP
            delay(500);
            Servo2.write(80);//down
            delay(500);
            break;
            
          } else if (GR_frequency >= 200 && GR_frequency <= 250 && GG_frequency <= 200 && GB_frequency >= 250 ||
              GR_frequency >= 90 && GR_frequency <= 210 && GG_frequency <= 80 && GB_frequency >= 90) {
            //colorReadings[i] = 5; // PURPLE
            Serial.println(" G PURPLE ");
            Servo2.write(110);//slowUP
              delay(400);
              Servo2.write(100);
              delay(400);
              Servo2.write(90);
              delay(400);
              Servo2.write(80);//UP
            delay(500);
            Servo1.write(30);//LEFT  28,88,148
            delay(500);
            Servo1.write(50);//right  28,88,148
            delay(500);
            Servo1.write(30);//LEFT  28,88,148
            delay(500);
            Servo1.write(50);//right  28,88,148
            delay(500);
            break;
          
          } else if (GB_frequency >= 170 && GR_frequency <= 50 || GR_frequency <=5 && GR_frequency >=0 && GB_frequency <=195 && GB_frequency >=0 ||
             GR_frequency <= 30 && GG_frequency <= 25 && GB_frequency >= 120) {
            //colorReadings[i] = 2; // BLUE
            Serial.println(" G BLUE ");
            Servo2.write(110);//slowUP
              delay(400);
              Servo2.write(100);
              delay(400);
              Servo2.write(90);
              delay(400);
              Servo2.write(80);//UP
            delay(500);
            Servo1.write(30);//LEFT  28,88,148
            delay(500);
            Servo1.write(50);//right  28,88,148
            delay(500);
            Servo1.write(30);//LEFT  28,88,148
            delay(500);
            Servo1.write(50);//right  28,88,148
            delay(500);
            break;
            

          }
        }

        //BE RED BLOCK HOME

        Servo2.write(85);//UP
        delay(800);
        Servo1.write(20);
        delay(400);
        Servo1.write(0);//RIGHT  28,88,148
        delay(800);
        Servo3.write(61);
        delay(400);
        Servo2.write(80);
        delay(400);
        Servo2.write(90);
        delay(400);
        Servo2.write(100);
        delay(400);
        Servo2.write(112);//DOWN

        delay(1600); //PAUSE TO READ COLOR


        while(true){

          digitalWrite(S2,LOW);
          digitalWrite(S3,LOW);
          // Reading the output frequency
          GR_frequency = pulseIn(sensorOut, LOW);
          //Remaping the value of the frequency to the RGB Model of 0 to 255
          GR_frequency = map(GR_frequency, 25,72,255,0);
          // Printing the value on the serial monitor
          Serial.println(" GREEN READING: ");
          Serial.print("G R= ");//printing name
          Serial.print(GR_frequency);//printing RED color frequency
          Serial.print("  ");
          delay(100);

        

          // Setting Green filtered photodiodes to be read
          digitalWrite(S2,HIGH);
          digitalWrite(S3,HIGH);
          // Reading the output frequency
          GG_frequency = pulseIn(sensorOut, LOW);
          //Remaping the value of the frequency to the RGB Model of 0 to 255
          GG_frequency = map(GG_frequency, 30,90,255,0);
          // Printing the value on the serial monitor
          Serial.print("G G= ");//printing name
          Serial.print(GG_frequency);//printing GREEN color frequency
          Serial.print("  ");
          delay(100);
          

          // Setting Blue filtered photodiodes to be read
          digitalWrite(S2,LOW);
          digitalWrite(S3,HIGH);
          // Reading the output frequency
          GB_frequency = pulseIn(sensorOut, LOW);
          //Remaping the value of the frequency to the RGB Model of 0 to 255
          GB_frequency = map(GB_frequency, 25,70,255,0);
          // Printing the value on the serial monitor
          Serial.print("G B= ");//printing name
          Serial.print(GB_frequency);//printing BLUE color frequency
          Serial.println("  ");
          delay(100);
        
          // Determine the color and store it in the readings array
          if (GR_frequency >= 200 && GG_frequency <= 70 && GB_frequency <= 100) {
          
            Serial.println(" G RED ");
            Servo2.write(110);//slowUP
              delay(400);
              Servo2.write(100);
              delay(400);
              Servo2.write(90);
              delay(500);
              Servo2.write(70);//UP
              delay(300);
            Servo2.write(60);//UP
            delay(500);
            Servo2.write(80);//down
            delay(500);
            Servo2.write(60);//UP
            delay(500);
            Servo2.write(80);//down
            delay(500);
            break;

            

          } else if (GR_frequency <= 100 && GG_frequency >= 170 && GB_frequency <= 145) {
            
            Serial.println(" G GREEN ");
            Servo2.write(110);//slowUP
              delay(400);
              Servo2.write(100);
              delay(400);
              Servo2.write(90);
              delay(400);
              Servo2.write(80);//UP
            delay(500);
            Servo1.write(20);// LEFT  28,88,148
            delay(500);
            Servo1.write(0);//right  28,88,148
            delay(500);
            Servo1.write(20);//LEFT  28,88,148
            delay(500);
            Servo1.write(0);//right  28,88,148
            delay(500);
            break;
            
          } else if (GR_frequency >= 220 && GG_frequency >= 90 && GG_frequency <= 160 && GB_frequency <= 80) {
            
            Serial.println(" G ORANGE ");
           Servo2.write(110);//slowUP
              delay(400);
              Servo2.write(100);
              delay(400);
              Servo2.write(90);
              delay(400);
              Servo2.write(80);//UP
            delay(500);
            Servo1.write(20);// LEFT  28,88,148
            delay(500);
            Servo1.write(0);//right  28,88,148
            delay(500);
            Servo1.write(20);//LEFT  28,88,148
            delay(500);
            Servo1.write(0);//right  28,88,148
            delay(500);
            break;
            
          } else if (GR_frequency >= 215 && GG_frequency >= 215 && GB_frequency <= 175) {
            //colorReadings[i] = 4; // YELLOW
            Serial.println(" G YELLOW ");
            Servo2.write(110);//slowUP
              delay(400);
              Servo2.write(100);
              delay(400);
              Servo2.write(90);
              delay(400);
              Servo2.write(80);//UP
            delay(500);
            Servo1.write(20);// LEFT  28,88,148
            delay(500);
            Servo1.write(0);//right  28,88,148
            delay(500);
            Servo1.write(20);//LEFT  28,88,148
            delay(500);
            Servo1.write(0);//right  28,88,148
            delay(500);
            break;
            
          } else if (GR_frequency >= 200 && GR_frequency <= 250 && GG_frequency <= 200 && GB_frequency >= 250 ||
              GR_frequency >= 90 && GR_frequency <= 210 && GG_frequency <= 80 && GB_frequency >= 90) {
            //colorReadings[i] = 5; // PURPLE
            Serial.println(" G PURPLE ");
            Servo2.write(110);//slowUP
              delay(400);
              Servo2.write(100);
              delay(400);
              Servo2.write(90);
              delay(400);
              Servo2.write(80);//UP
            delay(500);
            Servo1.write(20);// LEFT  28,88,148
            delay(500);
            Servo1.write(0);//right  28,88,148
            delay(500);
            Servo1.write(20);//LEFT  28,88,148
            delay(500);
            Servo1.write(0);//right  28,88,148
            delay(500);
            break;
          
          } else if (GB_frequency >= 170 && GR_frequency <= 50 || GR_frequency <=5 && GR_frequency >=0 && GB_frequency <=195 && GB_frequency >=0 ||
             GR_frequency <= 30 && GG_frequency <= 25 && GB_frequency >= 120) {
            //colorReadings[i] = 2; // BLUE
            Serial.println(" G BLUE ");
            Servo2.write(110);//slowUP
              delay(400);
              Servo2.write(100);
              delay(400);
              Servo2.write(90);
              delay(400);
              Servo2.write(80);//UP
            delay(500);
            Servo1.write(20);// LEFT  28,88,148
            delay(500);
            Servo1.write(0);//right  28,88,148
            delay(500);
            Servo1.write(20);//LEFT  28,88,148
            delay(500);
            Servo1.write(0);//right  28,88,148
            delay(500);
            break;

          }
        }
        // Finish green checking blocks

        // Home
        Servo1.write(88);//88
        delay(800);
        Serial.println(" IDLE MODE");
        Servo2.write(70);// //112 higher for block clearance
        delay(800);
        Servo3.write(50);//open30,close70,grip72
        delay(400);
        Servo3.write(62);
        


        break;
      }
      else
      {
        Serial.println(" ! IDLE MODE OFF ! ");
        delay(400);
        
        Servo3.write(55);
        delay(300);
        Servo3.write(60);
        delay(300);
        Servo3.write(55);
        delay(300);
        Servo3.write(60);
        delay(300);
        Servo2.write(80);
        delay(400);
        Servo2.write(90);
        delay(400);
        Servo2.write(100);
        delay(400);
        Servo2.write(112);
      }
    }
  } else {
    Serial.println(" Not all readings are the same color");
  }
}
